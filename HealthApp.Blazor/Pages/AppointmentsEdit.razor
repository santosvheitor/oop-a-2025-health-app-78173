@page "/appointments/edit/{Id:int}"
@using HealthApp.Domain.Models
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles="Admin")]

<h3>Edit Appointment</h3>

@if (isLoading)
{
    <p>Loading...</p>
}
else if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger">@errorMessage</div>
}
else if (appointment == null)
{
    <p>Appointment not found.</p>
}
else
{
    <EditForm Model="@appointment" OnValidSubmit="HandleValidSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label>Date:</label>
            <InputDate @bind-Value="appointment.Date" class="form-control" />
        </div>

        <div class="mb-3">
            <label>Patient:</label>
            <select @bind="appointment.PatientId" class="form-control">
                @foreach (var patient in patients)
                {
                    <option value="@patient.Id">@patient.FullName</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label>Doctor:</label>
            <select @bind="appointment.DoctorId" class="form-control">
                @foreach (var doctor in doctors)
                {
                    <option value="@doctor.Id">@doctor.FullName</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label>Status:</label>
            <InputText @bind-Value="appointment.Status" class="form-control" />
        </div>

        <button type="submit" class="btn btn-primary me-2">Save</button>
        <button type="button" class="btn btn-secondary" @onclick="Cancel">Cancel</button>
    </EditForm>
}